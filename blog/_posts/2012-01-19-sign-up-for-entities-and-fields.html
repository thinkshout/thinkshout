---
layout: post
title: Sign Up for Entities and Fields
---

<div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><h2>The challenge</h2>

<p><img src="http://thinkshout.com/sites/default/files/images/inline/ticket-icon.png" style="float: left; margin: 0 10px 10px 0;" />
Historically, the <a href="http://drupal.org/project/signup">Signup</a> module has been the go-to solution for managing event registrations (i.e., sign-ups) in Drupal. This venerable module has nearly <a href="http://drupal.org/project/usage/signup">8000 reported installs</a>, 14 contributors, and a vibrant ecosystem of additional contrib modules (such as <a href="http://drupal.org/project/uc_signup">Signup Integration for Ubercart</a>). Signup is also a key component of the <a href="http://drupal.org/project/cod">Conference Organizing Distribution</a>.</p>

<p>All this considered, only 500 of Signup's installs are in Drupal 7, for which the module still does not have a tagged, stable release. And since the module must maintain an upgrade path for all those users, taking full advantage of Drupal 7's new features, such as the entity system, is very challenging.</p>

<p>Given ThinkShout's comittment to Drupal innovation, last year we began work on an entity-based alternative to Signup, drawing significant inspiration from the amazing work that was already done there. We were very excited about the benefits offered by an entity-based registration system, namely the ability to add custom fields of any type to a registration, along with hooking into the various entity APIs. We launched an early version of the tool on <a href="http://thinkshout.com/portfolio/manhattan-kayak-company">Manhattan Kayak Company's</a> new website and started a <a href="http://drupal.org/node/1285384">conversation</a> with the Signup team about possible collaboration. While productive and receptive, things were moving a bit slowly, so we started up a new <a href="http://drupal.org/project/registration">Entity Registrations</a> project on Drupal.org and have recently pushed the code to a point where we want to share and discuss it with the community.
<!--break--></p>

<h2>Entity Registrations module architecture</h2>

<p>The module defines two custom entity types, registrations and registration types - following the pattern defined by <a href="http://drupal.org/project/entity">Entity API</a>, Entity Registration's only dependency. Registration types are the different bundles of registrations, which can be arbitrarily added, deleted, etc. Each bundle can have unique fields and display settings associated with it. When a site visitor registers for a registration of a given type, all of those fields are then made available, along with the default registration properties. Speaking of, aside from any fields you add to a registration bundle, it includes the following key properties:</p>

<ol>
<li>Type or bundle</li>
<li>Entity ID that the registration is associated with</li>
<li>Entity type that the registration is associated with</li>
<li>Email address of the registrant</li>
<li>Count, or how many slots this registration should use towards the total capacity for this event</li>
<li>Author user id (or an empty value for anonymous registrations)</li>
</ol>

<p>These properties highlight a couple key features. First, note that registrations require both an entity id <em>and</em> an entity type. That's because registrations can be associated with <em>any</em> entity type, not just nodes. That's right, registrations can be associated with a user, taxonomy term, or, say, a product entity. It's this last case that has us most excited and we plan on releasing <a href="http://drupal.org/commerce">Drupal Commerce</a> integration to support paid registrations in the near future. Second, the count field indicates that a single user can register more than one registrant. We've found this to be a common use case, E.g., someone at a company registering all of its employees for, say, DrupalCon, in one registration. You could even attach a <a href="http://drupal.org/project/field_collection">field collection</a> field to a registration allowing you to collect granular information for multiple registrants for a single registration. You might also want to consider <a href="http://drupal.org/project/field_collection_table">field collection table</a> to create tabular lists of registrants.</p>

<h2>Registration field</h2>

<p>We struggled with the best way to enable registrations of a given type (or bundle) for individual entities. We wanted to ensure that entity bundles could have default registrations types that could be overridden on a per-entity basis. The options were a) a standalone interface to set default registration types for each type of entity bundle, combined with an override option, or b) to create a new registration field type. We went the latter route and are really excited about early results. Here's how it works:</p>

<ul>
<li>Create one or more registration types.</li>
<li>Add a registration field to any entity bundle, E.g., node type, user, taxonomy term, product, etc. The possible values for this field will be all of the available registration types.</li>
<li>Select the display formatter for the field. Current options are the name of the registration type, a link to the registration form, or embedding the actual form with all the configured fields.</li>
<li>When you add or edit an entity, select the type of registrations you want to enable.</li>
</ul>

<p>The entity will now have a "manage registrations" local task which exposes all the settings and tools for that entity's registrations, including:</p>

<ul>
<li>Tabular list of registrants</li>
<li>Turn registrations on or off</li>
<li>Reminder date, settings and email template</li>
<li>Capacity</li>
<li>Whether or not to allow multiple registrants per registration</li>
<li>Broadcast tool to send emails to all registrants</li>
</ul>

<p>We had to jump through some hoops like forcing a cardinality of 1 on the field and preventing the attachment of more than registration field to an entity bundle. The solution is far from perfect, and we have some work to do in polishing it up, but, in our minds, the flexibility and ease of use outweighed any downsides.</p>

<h2>Also worth noting</h2>

<ul>
<li><a href="drupal.org/project/views">Views</a> and <a href="drupal.org/project/rules">Rules</a> integration is provided via the Entity API. The default registrants view likely won't cut it for many use cases.</li>
<li>Broadcast emails can be made transaction by using the STS feature of the <a href="http://drupal.org/project/mailchimp">MailChimp module</a>, or other similar services.</li>
</ul>

<h2>Next steps</h2>

<p>Aside from addressing overall polish and bugs, of which we're sure there are plenty at this point, we're looking at the following:</p>

<ol>
<li>Changing the current reminder date property to an more generic event date and then setting reminder, open, and close dates as relative values to the main event date. We've considered using a <a href="http://drupal.org/project/date">date</a> field and, at least for now, have decided not to make that a requirement. Individual implementations can certainly have a date field on an entity and copy that value over to the registration date on node_save().</li>
<li>Allowing users to edit their own registrations</li>
<li>The aforementioned Commerce integration</li>
<li>Perhaps moving the registration settings and/or defaults to the field level rather than entity level</li>
</ol>

<p>We'd love to get some feedback from the community on these and other features we may have missed, either in this post or over in the <a href="http://drupal.org/project/issues/registration">issue queue</a>. We had discussed <a href="http://usecod.com/news/2012/cod-2012-update-new-co-maintainer-drupal-7-acquia">Entity Registrations making its way into COD for D7</a> and would love to help with that effort. We're also still very open to possible collaborations with the Signup team. As we mentioned, a potential blocker to merging the projects is the upgrade path for existing Signup users.</p>
</div></div></div><div class="field field-name-taxonomy-vocabulary-1 field-type-taxonomy-term-reference field-label-above"><div class="field-label">Tags:&nbsp;</div><div class="field-items"><div class="field-item even"><a href="/blog/category/drupal" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Drupal</a></div><div class="field-item odd"><a href="/blog/category/modules" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">modules</a></div><div class="field-item even"><a href="/blog/category/drupal-planet" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Drupal Planet</a></div><div class="field-item odd"><a href="/taxonomy/term/45" typeof="skos:Concept" property="rdfs:label skos:prefLabel" datatype="">Drupal Give</a></div></div></div>
